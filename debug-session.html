<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temka Client - Debug Session</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00d4ff;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 20px;
            color: #00ff88;
        }

        .section {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .section h2 {
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            color: #0a0a0a;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 5px 5px 0;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .output {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 12px;
        }

        .success {
            color: #00ff88;
        }

        .error {
            color: #ff6b6b;
        }

        .info {
            color: #ffd700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Session - Temka Client</h1>

        <div class="section">
            <h2>üìä –°—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏</h2>
            <button onclick="checkSession()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
            <button onclick="clearSession()">–û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
            <div id="sessionOutput" class="output"></div>
        </div>

        <div class="section">
            <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <button onclick="showUsers()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button onclick="clearUsers()">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <div id="usersOutput" class="output"></div>
        </div>

        <div class="section">
            <h2>üì• –ó–∞–≥—Ä—É–∑–∫–∏</h2>
            <button onclick="showDownloads()">–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏</button>
            <button onclick="clearDownloads()">–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏</button>
            <div id="downloadsOutput" class="output"></div>
        </div>

        <div class="section">
            <h2>üß™ –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
            <button onclick="testAuth()">–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
            <div id="authOutput" class="output"></div>
        </div>

        <div class="section">
            <h2>üíæ LocalStorage</h2>
            <button onclick="showLocalStorage()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë localStorage</button>
            <button onclick="clearLocalStorage()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë localStorage</button>
            <div id="storageOutput" class="output"></div>
        </div>
    </div>

    <script src="api-local.js"></script>
    <script>
        function checkSession() {
            const el = document.getElementById('sessionOutput');
            const isAuth = api.isAuthenticated();
            const user = api.getCurrentUser();
            
            let output = `<span class="${isAuth ? 'success' : 'error'}">`;
            output += `–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${isAuth ? '–î–ê ‚úì' : '–ù–ï–¢ ‚úó'}\n\n`;
            
            if (user) {
                output += `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.username}\n`;
                output += `Email: ${user.email}\n`;
                output += `–õ–∏—Ü–µ–Ω–∑–∏—è: ${user.licenseKey}\n`;
                output += `–ó–∞–≥—Ä—É–∑–æ–∫: ${user.downloadsCount}\n`;
            } else {
                output += '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
            
            output += `</span>`;
            el.innerHTML = output;
        }

        function clearSession() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('token');
            document.getElementById('sessionOutput').innerHTML = '<span class="success">–°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞ ‚úì</span>';
        }

        function showUsers() {
            const el = document.getElementById('usersOutput');
            const users = api.getUsers();
            
            if (users.length === 0) {
                el.innerHTML = '<span class="info">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span>';
                return;
            }
            
            let output = `<span class="success">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}\n\n</span>`;
            users.forEach((user, i) => {
                output += `${i + 1}. ${user.username} (${user.email})\n`;
                output += `   –õ–∏—Ü–µ–Ω–∑–∏—è: ${user.licenseKey}\n`;
                output += `   –ó–∞–≥—Ä—É–∑–æ–∫: ${user.downloadsCount}\n\n`;
            });
            
            el.innerHTML = output;
        }

        function clearUsers() {
            localStorage.setItem('temka_users', JSON.stringify([]));
            document.getElementById('usersOutput').innerHTML = '<span class="success">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—á–∏—â–µ–Ω—ã ‚úì</span>';
        }

        function showDownloads() {
            const el = document.getElementById('downloadsOutput');
            const downloads = api.getDownloads();
            
            if (downloads.length === 0) {
                el.innerHTML = '<span class="info">–ó–∞–≥—Ä—É–∑–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span>';
                return;
            }
            
            let output = `<span class="success">–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∑–æ–∫: ${downloads.length}\n\n</span>`;
            downloads.forEach((dl, i) => {
                output += `${i + 1}. ${dl.filename} (v${dl.version})\n`;
                output += `   –î–∞—Ç–∞: ${new Date(dl.downloadedAt).toLocaleString('ru-RU')}\n\n`;
            });
            
            el.innerHTML = output;
        }

        function clearDownloads() {
            localStorage.setItem('temka_downloads', JSON.stringify([]));
            document.getElementById('downloadsOutput').innerHTML = '<span class="success">–ó–∞–≥—Ä—É–∑–∫–∏ –æ—á–∏—â–µ–Ω—ã ‚úì</span>';
        }

        function testAuth() {
            const el = document.getElementById('authOutput');
            let output = '';
            
            try {
                const isAuth = api.isAuthenticated();
                output += `<span class="${isAuth ? 'success' : 'error'}">`;
                output += `–°—Ç–∞—Ç—É—Å: ${isAuth ? '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚úì' : '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚úó'}\n`;
                output += `</span>`;
                
                if (isAuth) {
                    const user = api.getCurrentUser();
                    output += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.username}\n`;
                    output += `–ú–æ–∂–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å: –î–ê ‚úì`;
                } else {
                    output += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–µ –Ω–∞–π–¥–µ–Ω\n`;
                    output += `–ú–æ–∂–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å: –ù–ï–¢ ‚úó`;
                }
            } catch (error) {
                output = `<span class="error">–û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
            
            el.innerHTML = output;
        }

        function showLocalStorage() {
            const el = document.getElementById('storageOutput');
            let output = '<span class="info">';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                output += `${key}:\n`;
                
                try {
                    const parsed = JSON.parse(value);
                    output += JSON.stringify(parsed, null, 2);
                } catch {
                    output += value;
                }
                
                output += '\n\n';
            }
            
            output += '</span>';
            el.innerHTML = output;
        }

        function clearLocalStorage() {
            localStorage.clear();
            api.initDB();
            document.getElementById('storageOutput').innerHTML = '<span class="success">LocalStorage –æ—á–∏—â–µ–Ω ‚úì</span>';
        }

        // Check on load
        window.addEventListener('load', () => {
            checkSession();
        });
    </script>
</body>
</html>
